import { shortString as n, constants as o, CallData as A, addAddressPadding as y, getChecksumAddress as z, hash as D, typedData as I, TypedDataRevision as j } from "starknet";
const T = "0.10.5", d = {
  version: T
};
var w = /* @__PURE__ */ ((e) => (e.SUCCESS = "SUCCESS", e.NOT_CONNECTED = "NOT_CONNECTED", e.ERROR = "ERROR", e.CANCELED = "CANCELED", e.USER_INTERACTION_REQUIRED = "USER_INTERACTION_REQUIRED", e))(w || {}), l = /* @__PURE__ */ ((e) => (e.PAYMASTER = "PAYMASTER", e.CREDITS = "CREDITS", e))(l || {}), C = /* @__PURE__ */ ((e) => (e.NONFUNGIBLE = "NONFUNGIBLE", e.FUNGIBLE = "FUNGIBLE", e))(C || {});
const m = /* @__PURE__ */ new Set([
  "contracts",
  "messages",
  "target",
  "method",
  "name",
  "description",
  "types",
  "domain",
  "primaryType"
]);
function L(e) {
  if (!m.has(e))
    throw new Error(`Invalid property name: ${e}`);
}
function s(e, t) {
  return L(t), e[t];
}
function x(e) {
  return i(e).map((t) => ({
    entrypoint: t.entrypoint,
    contractAddress: y(t.contractAddress),
    calldata: A.toHex(t.calldata)
  }));
}
function U(e) {
  return Array.isArray(e) ? e.reduce(
    (t, N) => {
      if (s(N, "target")) {
        const M = z(
          s(N, "target")
        ), a = s(N, "method"), r = s(
          t,
          "contracts"
        ), c = {
          name: O(a),
          entrypoint: a,
          description: s(N, "description")
        };
        if (M in r) {
          const g = i(r[M].methods);
          r[M] = {
            methods: [...g, c]
          };
        } else
          r[M] = {
            methods: [c]
          };
      } else
        s(t, "messages").push(N);
      return t;
    },
    { contracts: {}, messages: [] }
  ) : e;
}
function k(e) {
  return [
    ...Object.entries(e.contracts ?? {}).flatMap(
      ([t, { methods: N }]) => i(N).map((M) => ({
        target: t,
        method: D.getSelectorFromName(M.entrypoint),
        authorized: M.authorized
      }))
    ),
    ...(e.messages ?? []).map((t) => {
      const N = I.getStructHash(
        t.types,
        "StarknetDomain",
        t.domain,
        j.ACTIVE
      ), M = I.getTypeHash(
        t.types,
        t.primaryType,
        j.ACTIVE
      );
      return {
        scope_hash: D.computePoseidonHash(N, M),
        authorized: t.authorized
      };
    })
  ];
}
function i(e) {
  return Array.isArray(e) ? e : [e];
}
function O(e) {
  return e.replace(/([a-z])([A-Z])/g, "$1 $2").replace(/_/g, " ").toLowerCase().replace(/^\w/, (t) => t.toUpperCase());
}
function f(e) {
  const t = e.pathname.split("/");
  if (e.hostname === "localhost" || e.hostname === "127.0.0.1" || e.hostname === "0.0.0.0") {
    if (typeof XMLHttpRequest > "u")
      return console.warn(
        `Cannot make synchronous HTTP call in Node.js environment for ${e.toString()}`
      ), n.encodeShortString("LOCALHOST");
    const N = new XMLHttpRequest();
    N.open("POST", e.toString(), !1), N.setRequestHeader("Content-Type", "application/json");
    const M = JSON.stringify({
      jsonrpc: "2.0",
      method: "starknet_chainId",
      params: [],
      id: 1
    });
    try {
      if (N.send(M), N.status === 200) {
        const a = JSON.parse(N.responseText);
        if (a.result)
          return a.result;
      }
      throw new Error(
        `Failed to get chain ID from ${e.toString()}: ${N.status} ${N.statusText}`
      );
    } catch (a) {
      throw new Error(`Failed to connect to ${e.toString()}: ${a}`);
    }
  }
  if (t.includes("starknet")) {
    if (t.includes("mainnet"))
      return o.StarknetChainId.SN_MAIN;
    if (t.includes("sepolia"))
      return o.StarknetChainId.SN_SEPOLIA;
  } else if (t.length >= 3) {
    const N = t[2];
    if (t.includes("katana"))
      return n.encodeShortString(
        `WP_${N.toUpperCase().replace(/-/g, "_")}`
      );
    if (t.includes("mainnet"))
      return n.encodeShortString(
        `GG_${N.toUpperCase().replace(/-/g, "_")}`
      );
  }
  throw new Error(`Chain ${e.toString()} not supported`);
}
class u extends Error {
  constructor() {
    super("Not ready to connect"), Object.setPrototypeOf(this, u.prototype);
  }
}
const P = "https://x.cartridge.gg", b = "https://api.cartridge.gg", h = {
  ACCOUNTS: "accounts"
}, E = "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAwIiBoZWlnaHQ9IjgwMCIgdmlld0JveD0iMCAwIDgwMCA4MDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxnIGZpbHRlcj0idXJsKCNmaWx0ZXIwX2RfNTExMl83ODIpIj4KPHBhdGggZD0iTTQ2OS4yMzYgNzBDNDgyLjM5IDcwIDQ5My4wNTMgODAuNjYzIDQ5My4wNTMgOTMuODE2NFYxNDcuMTQ3TDUxNS4zMzggMTQ3LjE0N0w1MTUuNDI4IDE0Ny4xNDdMNTE1LjU1NCAxNDcuMTQ3TDUxNS44MjYgMTQ3LjE0OUM1MTYuMDE2IDE0Ny4xNTEgNTE2LjIyNSAxNDcuMTUzIDUxNi40NTEgMTQ3LjE1N0M1MTYuOTA0IDE0Ny4xNjQgNTE3LjQyOCAxNDcuMTc2IDUxOC4wMiAxNDcuMTk1QzUxOS4yMDEgMTQ3LjIzNCA1MjAuNjYgMTQ3LjMwNCA1MjIuMzYxIDE0Ny40MjRDNTI1Ljc0MSAxNDcuNjYzIDUzMC4xODUgMTQ4LjExNCA1MzUuMzYzIDE0OC45NjlDNTQ1LjAwMSAxNTAuNTYyIDU1OC41NTYgMTUzLjc4IDU3Mi45MTggMTYwLjYwM0w3MzAuNDIgMjI2LjY3MUw3MzIuMTAxIDIyNy41MDVDNzcxLjc4NyAyNDcuMTc3IDc4OS45OTMgMjg2LjI5NiA3ODkuOTkzIDMyMi4wMzZWNTg1Ljg2NUM3ODkuOTkzIDU4Ni4wNTQgNzg5Ljk5NCA1ODYuMjU0IDc4OS45OTQgNTg2LjQ2M0w3ODkuOTk2IDU4Ni45MTNDNzkwLjAzOCA1OTcuMDk2IDc5MC4xNjEgNjI2Ljk5NiA3NjQuMjMxIDY1Mi44MjNMNzE0Ljc2IDcwMi4wOTVMNzE0LjY0MSA3MDIuMjE1QzcwNC42MDEgNzEyLjI3NSA2OTIuMTIzIDcyMC42NTIgNjc2LjI4NCA3MjQuODc5QzY2NC4zOSA3MjguMDU0IDY1Mi44MjcgNzI3Ljk2NiA2NDguNjM3IDcyNy45MzRMNjQ4LjYxOSA3MjcuOTMzQzY0OC40MDkgNzI3LjkzMiA2NDguMjE5IDcyNy45MyA2NDguMDQ3IDcyNy45M0w2NDcuNzUyIDcyNy45MjlINDgwLjcyMUM0NzQuMDk0IDcyNy45MjkgNDY4LjcyMSA3MjIuNTU2IDQ2OC43MjEgNzE1LjkyOVY2NjguMzg4SDMyOC41ODZDMzI4LjU4NiA2NzIuNjI5IDMyOC41NzIgNjk4LjA1MiAzMjguNTYxIDcxNS45NDRDMzI4LjU1NyA3MjIuNTY5IDMyMy4xODYgNzI3LjkyOSAzMTYuNTYxIDcyNy45MjlIMTUyLjI0NkMxNTIuMTA0IDcyNy45MjkgMTUxLjk0MiA3MjcuOTI5IDE1MS43NjIgNzI3LjkzMUwxNTEuMzYyIDcyNy45MzRDMTQ3LjE3MiA3MjcuOTY2IDEzNS42MDkgNzI4LjA1NCAxMjMuNzE0IDcyNC44NzlDMTA3Ljg3MyA3MjAuNjUxIDk1LjM5MzggNzEyLjI3MiA4NS4zNTI5IDcwMi4yMUw4NS4yMzg2IDcwMi4wOTVMMzUuNjcgNjUyLjcyNUwzNS41NzIzIDY1Mi42MjdDOS44NjI0MiA2MjYuNzggOS45NjY3IDU5Ny4xODUgMTAuMDAzIDU4Ni44NzRDMTAuMDA0MyA1ODYuNTEzIDEwLjAwNTUgNTg2LjE3NyAxMC4wMDU1IDU4NS44NjVWMzIyLjAzNkMxMC4wMDU1IDI4Ni40MyAyOC4xNjYyIDI0Ny4xOTkgNjcuODk3NyAyMjcuNTA1TDY5LjU3OSAyMjYuNjcxTDIyNy4wODEgMTYwLjYwM0MyNDEuNDQzIDE1My43OCAyNTQuOTk4IDE1MC41NjIgMjY0LjYzNiAxNDguOTY5QzI2OS44MTQgMTQ4LjExNCAyNzQuMjU4IDE0Ny42NjMgMjc3LjYzOCAxNDcuNDI0QzI3OS4zMzggMTQ3LjMwNCAyODAuNzk4IDE0Ny4yMzQgMjgxLjk3OSAxNDcuMTk1QzI4Mi41NzEgMTQ3LjE3NiAyODMuMDk1IDE0Ny4xNjQgMjgzLjU0NyAxNDcuMTU3TDI4My45MTcgMTQ3LjE1MkwyODQuMTczIDE0Ny4xNDlMMjg0LjQ0NSAxNDcuMTQ3TDI4NC41NzEgMTQ3LjE0N0wyODQuNjYgMTQ3LjE0N0wzMDYuOTQyIDE0Ny4xNDdWOTMuODE2NEMzMDYuOTQyIDgwLjY2MyAzMTcuNjA1IDcwIDMzMC43NTggNzBINDY5LjIzNloiIGZpbGw9IiMxOTFBMUEiLz4KPHBhdGggZD0iTTM2Ni40ODMgMTI5LjU0SDQzMy41MTJWMjA2LjY4N0gzNjYuNDgzVjEyOS41NFoiIGZpbGw9IiNGQkNCNEEiLz4KPHBhdGggZD0iTTI2OS4wMSA2MDIuNDI5SDE0NC4wMDhDMTM1Ljc2OCA2MDIuNDI5IDEzNS43NjggNTk0LjE0NiAxMzUuNzY4IDU5NC4xNDZWMjgwLjg1QzEzNS43NjggMjgwLjg1IDEzNS43NjggMjcyLjY0NCAxNDQuMDA4IDI3Mi42NDRIMzY2LjQ4M0wzNjYuNDgzIDIwNi42ODdIMjg0LjY5QzI4NC42OSAyMDYuNjg3IDI2OC4xMzQgMjA2LjY4NyAyNTEuNTc5IDIxNC44OTNMOTQuMzQxNCAyODAuODVDNzcuNzg2MSAyODkuMDU3IDY5LjU0NjkgMzA1LjYyMyA2OS41NDY5IDMyMi4wMzVWNTg1Ljg2M0M2OS41NDY5IDU5NC4xNDcgNjkuNTQ2OSA2MDIuMzUzIDc3Ljc4NjEgNjEwLjYzNkwxMjcuNDUyIDY2MC4xMDRDMTM1LjY5MSA2NjguMzg3IDE0MS45MjggNjY4LjM4NyAxNTIuMjQ3IDY2OC4zODdIMjY5LjAyOUMyNjkuMDM3IDY0OC4zNCAyNjkuMDQ2IDYyNC42NTUgMjY5LjA1NCA2MDIuODg3SDUyOC4wMTNWNjY4LjM4N0g2NDcuNzUzQzY1OC4wNzEgNjY4LjM4NyA2NjQuMzA4IDY2OC4zODcgNjcyLjU0NyA2NjAuMTA0TDcyMi4yMTMgNjEwLjYzNkM3MzAuNDUzIDYwMi40MjkgNzMwLjQ1MyA1OTQuMTQ3IDczMC40NTMgNTg1Ljg2M1YzMjIuMDM1QzczMC40NTMgMzA1LjU0NiA3MjIuMjEzIDI4OS4wNTcgNzA1LjY1OCAyODAuODVMNTQ4LjQyMSAyMTQuODkzQzUzMS44NjUgMjA2LjY4NyA1MTUuMzEgMjA2LjY4NyA1MTUuMzEgMjA2LjY4N0g0MzMuNTEyTDQzMy41MTIgMjcyLjY0NEg2NTYuMDY5QzY2NC4zMDggMjcyLjY0NCA2NjQuMzA4IDI4MC44NSA2NjQuMzA4IDI4MC44NVY1OTQuMTQ2QzY2NC4zMDggNTk0LjE0NiA2NjQuMzA4IDYwMi40MjkgNjU2LjA2OSA2MDIuNDI5SDUyOC4yNjJWNTM3LjM5NkgyNjkuMDc1QzI2OS4wNzUgNTQzLjcwNyAyNjkuMDE3IDU5Ni45MTIgMjY5LjAxIDYwMi40MjlaIiBmaWxsPSIjRkJDQjRBIi8+CjxwYXRoIGQ9Ik0yNjkuMDA5IDQzNi4xNzJINTI4LjI2MlYzNzAuNjgxSDI2OS4wNzVDMjY5LjA3NSAzNzcuMzczIDI2OS4wMDkgNDM2Ljc4OCAyNjkuMDA5IDQzNi4xNzJaIiBmaWxsPSIjRkJDQjRBIi8+CjwvZz4KPGRlZnM+CjxmaWx0ZXIgaWQ9ImZpbHRlcjBfZF81MTEyXzc4MiIgeD0iLTQiIHk9IjAiIHdpZHRoPSI4MDgiIGhlaWdodD0iODA4IiBmaWx0ZXJVbml0cz0idXNlclNwYWNlT25Vc2UiIGNvbG9yLWludGVycG9sYXRpb24tZmlsdGVycz0ic1JHQiI+CjxmZUZsb29kIGZsb29kLW9wYWNpdHk9IjAiIHJlc3VsdD0iQmFja2dyb3VuZEltYWdlRml4Ii8+CjxmZUNvbG9yTWF0cml4IGluPSJTb3VyY2VBbHBoYSIgdHlwZT0ibWF0cml4IiB2YWx1ZXM9IjAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDEyNyAwIiByZXN1bHQ9ImhhcmRBbHBoYSIvPgo8ZmVPZmZzZXQgZHk9IjQiLz4KPGZlR2F1c3NpYW5CbHVyIHN0ZERldmlhdGlvbj0iMiIvPgo8ZmVDb21wb3NpdGUgaW4yPSJoYXJkQWxwaGEiIG9wZXJhdG9yPSJvdXQiLz4KPGZlQ29sb3JNYXRyaXggdHlwZT0ibWF0cml4IiB2YWx1ZXM9IjAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAuMjUgMCIvPgo8ZmVCbGVuZCBtb2RlPSJub3JtYWwiIGluMj0iQmFja2dyb3VuZEltYWdlRml4IiByZXN1bHQ9ImVmZmVjdDFfZHJvcFNoYWRvd181MTEyXzc4MiIvPgo8ZmVCbGVuZCBtb2RlPSJub3JtYWwiIGluPSJTb3VyY2VHcmFwaGljIiBpbjI9ImVmZmVjdDFfZHJvcFNoYWRvd181MTEyXzc4MiIgcmVzdWx0PSJzaGFwZSIvPgo8L2ZpbHRlcj4KPC9kZWZzPgo8L3N2Zz4K";
function S() {
}
class Y {
  m_lastPromise = Promise.resolve();
  /**
   * Acquire lock
   * @param [bypass=false] option to skip lock acquisition
   */
  async obtain(t = !1) {
    let N = S;
    if (t) return N;
    const M = this.m_lastPromise;
    return this.m_lastPromise = new Promise((a) => N = a), await M, N;
  }
}
const p = new Y();
class Z {
  id = "controller";
  name = "Controller";
  version = d.version;
  icon = E;
  account;
  subscriptions = [];
  _probePromise = null;
  async safeProbe() {
    if (this.account)
      return this.account;
    if (this._probePromise)
      return this._probePromise;
    const t = await p.obtain();
    return await new Promise(async (N) => {
      try {
        this._probePromise = this.probe();
        const M = await this._probePromise;
        N(M);
      } finally {
        this._probePromise = null;
      }
    }).finally(() => {
      t();
    });
  }
  request = async (t) => {
    switch (t.type) {
      case "wallet_getPermissions":
        return await this.safeProbe(), this.account ? [h.ACCOUNTS] : [];
      case "wallet_requestAccounts": {
        if (this.account)
          return [this.account.address];
        const M = t.params && t.params.silent_mode;
        return this.account = await this.safeProbe(), !this.account && !M && (this.account = await this.connect()), this.account ? [this.account.address] : [];
      }
      case "wallet_watchAsset":
        throw {
          code: 63,
          message: "An unexpected error occurred",
          data: "wallet_watchAsset not implemented"
        };
      case "wallet_addStarknetChain": {
        let M = t.params;
        return this.addStarknetChain(M);
      }
      case "wallet_switchStarknetChain": {
        let M = t.params;
        return this.switchStarknetChain(M.chainId);
      }
      case "wallet_requestChainId":
        if (!this.account)
          throw {
            code: 63,
            message: "An unexpected error occurred",
            data: "Account not initialized"
          };
        return await this.account.getChainId();
      case "wallet_deploymentData":
        throw {
          code: 63,
          message: "An unexpected error occurred",
          data: "wallet_deploymentData not implemented"
        };
      case "wallet_addInvokeTransaction":
        if (!this.account)
          throw {
            code: 63,
            message: "An unexpected error occurred",
            data: "Account not initialized"
          };
        let N = t.params;
        return await this.account.execute(
          N.calls.map((M) => ({
            contractAddress: M.contract_address,
            entrypoint: M.entry_point,
            calldata: M.calldata
          }))
        );
      case "wallet_addDeclareTransaction":
        throw {
          code: 63,
          message: "An unexpected error occurred",
          data: "wallet_addDeclareTransaction not implemented"
        };
      case "wallet_signTypedData": {
        if (!this.account)
          throw {
            code: 63,
            message: "An unexpected error occurred",
            data: "Account not initialized"
          };
        return await this.account.signMessage(t.params);
      }
      case "wallet_supportedSpecs":
        return [];
      case "wallet_supportedWalletApi":
        return [];
      default:
        throw {
          code: 63,
          message: "An unexpected error occurred",
          data: `Unknown RPC call type: ${t.type}`
        };
    }
  };
  on = (t, N) => {
    if (t !== "accountsChanged" && t !== "networkChanged")
      throw new Error(`Unknown event: ${t}`);
    this.subscriptions.push({ type: t, handler: N });
  };
  off = (t, N) => {
    if (t !== "accountsChanged" && t !== "networkChanged")
      throw new Error(`Unknown event: ${t}`);
    const M = this.subscriptions.findIndex(
      (a) => a.type === t && a.handler === N
    );
    M >= 0 && this.subscriptions.splice(M, 1);
  };
  emitNetworkChanged(t) {
    this.subscriptions.filter((N) => N.type === "networkChanged").forEach((N) => {
      N.handler(t);
    });
  }
  emitAccountsChanged(t) {
    this.subscriptions.filter((N) => N.type === "accountsChanged").forEach((N) => {
      N.handler(t);
    });
  }
}
export {
  b as A,
  Z as B,
  l as F,
  P as K,
  u as N,
  w as R,
  C as S,
  U as a,
  k as b,
  O as h,
  x as n,
  f as p,
  i as t,
  T as v
};
//# sourceMappingURL=provider-CznCrt4b.js.map
