{"version":3,"sources":["../../src/web/sql/index.ts"],"sourcesContent":["import {\n    type UseQueryOptions,\n    useQuery as useTanStackQuery,\n} from \"@tanstack/react-query\";\n\n/**\n * Simple function to query Torii instance over sql endpoint.\n *\n * This endpoint is mainly meant to be used as analytical query system.\n * For more informations and examples, head over to `examples/example-vite-react-sql` example\n *\n *\n * @template Input - The type your data have raw, just straight out of sql\n * @template Output - The type that will have your data after going through `formatFn`\n * @param {string} toriiUrl - Torii url\n * @param {string} query - Your raw sql query\n * @param {(rows: Input) => Output} formatFn - Format function callback\n * @returns {Promise<Output>} - Formatted data\n */\nexport async function queryTorii<Input, Output>(\n    toriiUrl: string,\n    query: string,\n    formatFn: (rows: Input) => Output\n): Promise<Output> {\n    try {\n        const response = await fetch(`${toriiUrl}/sql`, {\n            method: \"POST\",\n            headers: {\n                \"Content-Type\": \"application/json\",\n            },\n            body: query,\n        });\n        if (!response.ok) throw new Error(\"Failed to fetch data\");\n        return formatFn(await response.json());\n    } catch (error) {\n        console.error(\"Error fetching data:\", error);\n        throw error;\n    }\n}\n\n/**\n *\n */\nexport function useToriiSQLQuery<Output, Input>(\n    query: string,\n    formatFn: (rows: Input) => Output,\n    defaultValue?: UseQueryOptions<Output>[\"placeholderData\"],\n    toriiUrl?: string\n) {\n    const { data, error, isPending, isRefetching } = useTanStackQuery({\n        queryKey: [query],\n        queryFn: async () => {\n            return await queryTorii(\n                toriiUrl ?? \"http://127.0.0.1:8080\",\n                query,\n                formatFn\n            );\n        },\n        // @ts-expect-error trust me\n        placeholderData: defaultValue ?? [],\n    });\n\n    return {\n        data,\n        error,\n        isPending,\n        isRefetching,\n    };\n}\n"],"mappings":"AAAA,OAEI,YAAYA,MACT,wBAgBP,eAAsBC,EAClBC,EACAC,EACAC,EACe,CACf,GAAI,CACA,IAAMC,EAAW,MAAM,MAAM,GAAGH,CAAQ,OAAQ,CAC5C,OAAQ,OACR,QAAS,CACL,eAAgB,kBACpB,EACA,KAAMC,CACV,CAAC,EACD,GAAI,CAACE,EAAS,GAAI,MAAM,IAAI,MAAM,sBAAsB,EACxD,OAAOD,EAAS,MAAMC,EAAS,KAAK,CAAC,CACzC,OAASC,EAAO,CACZ,cAAQ,MAAM,uBAAwBA,CAAK,EACrCA,CACV,CACJ,CAKO,SAASC,EACZJ,EACAC,EACAI,EACAN,EACF,CACE,GAAM,CAAE,KAAAO,EAAM,MAAAH,EAAO,UAAAI,EAAW,aAAAC,CAAa,EAAIX,EAAiB,CAC9D,SAAU,CAACG,CAAK,EAChB,QAAS,SACE,MAAMF,EACTC,GAAY,wBACZC,EACAC,CACJ,EAGJ,gBAAiBI,GAAgB,CAAC,CACtC,CAAC,EAED,MAAO,CACH,KAAAC,EACA,MAAAH,EACA,UAAAI,EACA,aAAAC,CACJ,CACJ","names":["useTanStackQuery","queryTorii","toriiUrl","query","formatFn","response","error","useToriiSQLQuery","defaultValue","data","isPending","isRefetching"]}