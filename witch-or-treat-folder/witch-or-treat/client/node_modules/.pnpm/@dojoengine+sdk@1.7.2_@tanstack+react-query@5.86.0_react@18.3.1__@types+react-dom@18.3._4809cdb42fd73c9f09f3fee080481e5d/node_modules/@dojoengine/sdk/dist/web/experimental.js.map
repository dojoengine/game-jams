{"version":3,"sources":["../../src/web/experimental/index.ts"],"sourcesContent":["import * as torii from \"@dojoengine/torii-wasm\";\nimport {\n    parseEntities,\n    type SchemaType,\n    type SDKConfig,\n    type StandardizedQueryResult,\n} from \"@dojoengine/internal\";\nimport { defaultClientConfig } from \"..\";\n\nexport type ToriiSubscriptionCallback<T extends SchemaType> = (response: {\n    data?: StandardizedQueryResult<T> | StandardizedQueryResult<T>[];\n    error?: Error;\n}) => void;\n\n// @deprecated for now use import { init } from \"@dojoengine/sdk\"\nexport async function init<T extends SchemaType>(options: SDKConfig) {\n    const clientConfig = {\n        ...defaultClientConfig,\n        ...options.client,\n    } as torii.ClientConfig;\n\n    const client = new torii.ToriiClient(clientConfig);\n\n    return {\n        getEntities: async (query: torii.Query) => {\n            return parseEntities((await client.getEntities(query)).items);\n        },\n        getEvents: async (query: torii.Query) => {\n            const events = await client.getEventMessages(query);\n            return parseEntities(events.items);\n        },\n        subscribeEntities: async (\n            query: torii.Query,\n            callback: ToriiSubscriptionCallback<T>\n        ) => {\n            const entities = parseEntities<T>(\n                (await client.getEntities(query)).items\n            );\n            return [\n                entities,\n                client.onEntityUpdated(\n                    query.clause,\n                    (_: string, entityData: torii.Entity) => {\n                        try {\n                            if (callback) {\n                                const parsedData = parseEntities<T>([\n                                    entityData,\n                                ]);\n                                callback({ data: parsedData });\n                            }\n                        } catch (error) {\n                            if (callback) {\n                                callback({\n                                    error:\n                                        error instanceof Error\n                                            ? error\n                                            : new Error(String(error)),\n                                });\n                            }\n                        }\n                    }\n                ),\n            ];\n        },\n        subscribeEvents: async (\n            query: torii.Query,\n            callback: ToriiSubscriptionCallback<T>\n        ) => {\n            if (\n                query.no_hashed_keys &&\n                query.clause &&\n                !Object.hasOwn(query.clause, \"Keys\")\n            ) {\n                throw new Error(\n                    \"For subscription, you need to include entity ids\"\n                );\n            }\n            const events = parseEntities<T>(\n                (await client.getEventMessages(query)).items\n            );\n            return [\n                events,\n                client.onEventMessageUpdated(\n                    query.clause,\n                    (_: string, entityData: any) => {\n                        try {\n                            if (callback) {\n                                const parsedData = parseEntities<T>([\n                                    entityData,\n                                ]);\n                                callback({ data: parsedData });\n                            }\n                        } catch (error) {\n                            if (callback) {\n                                callback({\n                                    error:\n                                        error instanceof Error\n                                            ? error\n                                            : new Error(String(error)),\n                                });\n                            }\n                        }\n                    }\n                ),\n            ];\n        },\n    };\n}\n"],"mappings":"+CAAA,UAAYA,MAAW,yBAevB,eAAsBC,EAA2BC,EAAoB,CACjE,IAAMC,EAAe,CACjB,GAAGC,EACH,GAAGF,EAAQ,MACf,EAEMG,EAAS,IAAU,cAAYF,CAAY,EAEjD,MAAO,CACH,YAAa,MAAOG,GACTC,GAAe,MAAMF,EAAO,YAAYC,CAAK,GAAG,KAAK,EAEhE,UAAW,MAAOA,GAAuB,CACrC,IAAME,EAAS,MAAMH,EAAO,iBAAiBC,CAAK,EAClD,OAAOC,EAAcC,EAAO,KAAK,CACrC,EACA,kBAAmB,MACfF,EACAG,IAKO,CAHUF,GACZ,MAAMF,EAAO,YAAYC,CAAK,GAAG,KACtC,EAGID,EAAO,gBACHC,EAAM,OACN,CAACI,EAAWC,IAA6B,CACrC,GAAI,CACA,GAAIF,EAAU,CACV,IAAMG,EAAaL,EAAiB,CAChCI,CACJ,CAAC,EACDF,EAAS,CAAE,KAAMG,CAAW,CAAC,CACjC,CACJ,OAASC,EAAO,CACRJ,GACAA,EAAS,CACL,MACII,aAAiB,MACXA,EACA,IAAI,MAAM,OAAOA,CAAK,CAAC,CACrC,CAAC,CAET,CACJ,CACJ,CACJ,EAEJ,gBAAiB,MACbP,EACAG,IACC,CACD,GACIH,EAAM,gBACNA,EAAM,QACN,CAAC,OAAO,OAAOA,EAAM,OAAQ,MAAM,EAEnC,MAAM,IAAI,MACN,kDACJ,EAKJ,MAAO,CAHQC,GACV,MAAMF,EAAO,iBAAiBC,CAAK,GAAG,KAC3C,EAGID,EAAO,sBACHC,EAAM,OACN,CAACI,EAAWC,IAAoB,CAC5B,GAAI,CACA,GAAIF,EAAU,CACV,IAAMG,EAAaL,EAAiB,CAChCI,CACJ,CAAC,EACDF,EAAS,CAAE,KAAMG,CAAW,CAAC,CACjC,CACJ,OAASC,EAAO,CACRJ,GACAA,EAAS,CACL,MACII,aAAiB,MACXA,EACA,IAAI,MAAM,OAAOA,CAAK,CAAC,CACrC,CAAC,CAET,CACJ,CACJ,CACJ,CACJ,CACJ,CACJ","names":["torii","init","options","clientConfig","defaultClientConfig","client","query","E","events","callback","_","entityData","parsedData","error"]}