import{createStore as X}from"zustand/vanilla";import{applyPatches as $,enablePatches as z,produceWithPatches as K}from"immer";import{subscribeWithSelector as J}from"zustand/middleware";import{immer as Y}from"zustand/middleware/immer";import{shortString as se}from"starknet";import{CairoCustomEnum as I,CairoOption as E,CairoOptionVariant as A}from"starknet";import{CairoCustomEnum as ue,CairoOption as ce,CairoOptionVariant as de,addAddressPadding as le}from"starknet";import{addAddressPadding as he}from"starknet";var H={withStackTrace:!1},U=(r,e,t=H)=>{let a=e.isOk()?{type:"Ok",value:e.value}:{type:"Err",value:e.error},n=t.withStackTrace?new Error().stack:void 0;return{data:a,message:r,stack:n}};function v(r,e,t,a){function n(s){return s instanceof t?s:new t(function(i){i(s)})}return new(t||(t=Promise))(function(s,i){function o(c){try{l(a.next(c))}catch(f){i(f)}}function u(c){try{l(a.throw(c))}catch(f){i(f)}}function l(c){c.done?s(c.value):n(c.value).then(o,u)}l((a=a.apply(r,e||[])).next())})}function x(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],a=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&a>=r.length&&(r=void 0),{value:r&&r[a++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function p(r){return this instanceof p?(this.v=r,this):new p(r)}function D(r,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var a=t.apply(r,e||[]),n,s=[];return n=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),o("next"),o("throw"),o("return",i),n[Symbol.asyncIterator]=function(){return this},n;function i(d){return function(T){return Promise.resolve(T).then(d,f)}}function o(d,T){a[d]&&(n[d]=function(S){return new Promise(function(G,q){s.push([d,S,G,q])>1||u(d,S)})},T&&(n[d]=T(n[d])))}function u(d,T){try{l(a[d](T))}catch(S){b(s[0][3],S)}}function l(d){d.value instanceof p?Promise.resolve(d.value.v).then(c,f):b(s[0][2],d)}function c(d){u("next",d)}function f(d){u("throw",d)}function b(d,T){d(T),s.shift(),s.length&&u(s[0][0],s[0][1])}}function W(r){var e,t;return e={},a("next"),a("throw",function(n){throw n}),a("return"),e[Symbol.iterator]=function(){return this},e;function a(n,s){e[n]=r[n]?function(i){return(t=!t)?{value:p(r[n](i)),done:!1}:s?s(i):i}:s}}function F(r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=r[Symbol.asyncIterator],t;return e?e.call(r):(r=typeof x=="function"?x(r):r[Symbol.iterator](),t={},a("next"),a("throw"),a("return"),t[Symbol.asyncIterator]=function(){return this},t);function a(s){t[s]=r[s]&&function(i){return new Promise(function(o,u){i=r[s](i),n(o,u,i.done,i.value)})}}function n(s,i,o,u){Promise.resolve(u).then(function(l){s({value:l,done:o})},i)}}var g=class r{constructor(e){this._promise=e}static fromSafePromise(e){let t=e.then(a=>new m(a));return new r(t)}static fromPromise(e,t){let a=e.then(n=>new m(n)).catch(n=>new h(t(n)));return new r(a)}static fromThrowable(e,t){return(...a)=>new r(v(this,void 0,void 0,function*(){try{return new m(yield e(...a))}catch(n){return new h(t?t(n):n)}}))}static combine(e){return L(e)}static combineWithAllErrors(e){return R(e)}map(e){return new r(this._promise.then(t=>v(this,void 0,void 0,function*(){return t.isErr()?new h(t.error):new m(yield e(t.value))})))}andThrough(e){return new r(this._promise.then(t=>v(this,void 0,void 0,function*(){if(t.isErr())return new h(t.error);let a=yield e(t.value);return a.isErr()?new h(a.error):new m(t.value)})))}andTee(e){return new r(this._promise.then(t=>v(this,void 0,void 0,function*(){if(t.isErr())return new h(t.error);try{yield e(t.value)}catch{}return new m(t.value)})))}orTee(e){return new r(this._promise.then(t=>v(this,void 0,void 0,function*(){if(t.isOk())return new m(t.value);try{yield e(t.error)}catch{}return new h(t.error)})))}mapErr(e){return new r(this._promise.then(t=>v(this,void 0,void 0,function*(){return t.isOk()?new m(t.value):new h(yield e(t.error))})))}andThen(e){return new r(this._promise.then(t=>{if(t.isErr())return new h(t.error);let a=e(t.value);return a instanceof r?a._promise:a}))}orElse(e){return new r(this._promise.then(t=>v(this,void 0,void 0,function*(){return t.isErr()?e(t.error):new m(t.value)})))}match(e,t){return this._promise.then(a=>a.match(e,t))}unwrapOr(e){return this._promise.then(t=>t.unwrapOr(e))}safeUnwrap(){return D(this,arguments,function*(){return yield p(yield p(yield*W(F(yield p(this._promise.then(t=>t.safeUnwrap()))))))})}then(e,t){return this._promise.then(e,t)}[Symbol.asyncIterator](){return D(this,arguments,function*(){let t=yield p(this._promise);return t.isErr()&&(yield yield p(P(t.error))),yield p(t.value)})}};function P(r){return new g(Promise.resolve(new h(r)))}var Z=g.fromPromise,ee=g.fromSafePromise,te=g.fromThrowable,j=r=>{let e=w([]);for(let t of r)if(t.isErr()){e=y(t.error);break}else e.map(a=>a.push(t.value));return e},L=r=>g.fromSafePromise(Promise.all(r)).andThen(j),B=r=>{let e=w([]);for(let t of r)t.isErr()&&e.isErr()?e.error.push(t.error):t.isErr()&&e.isOk()?e=y([t.error]):t.isOk()&&e.isOk()&&e.value.push(t.value);return e},R=r=>g.fromSafePromise(Promise.all(r)).andThen(B),C;(function(r){function e(n,s){return(...i)=>{try{let o=n(...i);return w(o)}catch(o){return y(s?s(o):o)}}}r.fromThrowable=e;function t(n){return j(n)}r.combine=t;function a(n){return B(n)}r.combineWithAllErrors=a})(C||(C={}));function w(r){return new m(r)}function y(r){return new h(r)}var m=class{constructor(e){this.value=e}isOk(){return!0}isErr(){return!this.isOk()}map(e){return w(e(this.value))}mapErr(e){return w(this.value)}andThen(e){return e(this.value)}andThrough(e){return e(this.value).map(t=>this.value)}andTee(e){try{e(this.value)}catch{}return w(this.value)}orTee(e){return w(this.value)}orElse(e){return w(this.value)}asyncAndThen(e){return e(this.value)}asyncAndThrough(e){return e(this.value).map(()=>this.value)}asyncMap(e){return g.fromSafePromise(e(this.value))}unwrapOr(e){return this.value}match(e,t){return e(this.value)}safeUnwrap(){let e=this.value;return function*(){return e}()}_unsafeUnwrap(e){return this.value}_unsafeUnwrapErr(e){throw U("Called `_unsafeUnwrapErr` on an Ok",this,e)}*[Symbol.iterator](){return this.value}},h=class{constructor(e){this.error=e}isOk(){return!1}isErr(){return!this.isOk()}map(e){return y(this.error)}mapErr(e){return y(e(this.error))}andThrough(e){return y(this.error)}andTee(e){return y(this.error)}orTee(e){try{e(this.error)}catch{}return y(this.error)}andThen(e){return y(this.error)}orElse(e){return e(this.error)}asyncAndThen(e){return P(this.error)}asyncAndThrough(e){return P(this.error)}asyncMap(e){return P(this.error)}unwrapOr(e){return e}match(e,t){return t(this.error)}safeUnwrap(){let e=this.error;return function*(){throw yield y(e),new Error("Do not use this generator out of `safeTry`")}()}_unsafeUnwrap(e){throw U("Called `_unsafeUnwrap` on an Err",this,e)}_unsafeUnwrapErr(e){return this.error}*[Symbol.iterator](){let e=this;return yield e,e}},re=C.fromThrowable;function N(r){return r instanceof E}function V(r,e){return e instanceof E&&e.isSome()?new E(A.Some,e.unwrap()):r instanceof E?r.isSome()?new E(A.Some,r.unwrap()):new E(A.None):r}function k(r){return r instanceof I}function Q(r,e){if(!k(r)||!k(e))return r;let t=e.activeVariant(),a=e.unwrap();if(t&&a!==void 0){let i={};for(let o in r.variant)i[o]=void 0;return i[t]=a,new I(i)}let n=r.activeVariant(),s=r.unwrap();if(n&&s!==void 0){let i={};for(let o in r.variant)i[o]=void 0;return i[n]=s,new I(i)}return r}function _(r,e){if(N(r)&&N(e))return V(r,e);if(k(r)&&k(e))return Q(r,e);let t={...r};for(let a in e)Object.hasOwn(e,a)&&(e[a]!==null&&typeof e[a]=="object"&&!Array.isArray(e[a])&&a in r&&typeof r[a]=="object"&&!Array.isArray(r[a])?t[a]=_(r[a],e[a]):t[a]=e[a]);return t}z();function O(r,e){return r.entityId===e.entityId&&JSON.stringify(r.models)===JSON.stringify(e.models)}function M(r){let e=r(J(Y((t,a)=>({entities:{},historical_entities:{},pendingTransactions:{},setEntities:n=>{t(s=>{for(let i of n)s.entities[i.entityId]=i})},mergeEntities:n=>{t(s=>{for(let i of n)if(i.entityId&&i.models){let o=s.entities[i.entityId];if(!o){s.entities[i.entityId]=i;continue}let u=Object.assign({},o.models);for(let[l,c]of Object.entries(i.models)){let f=l;f in u||(u[f]={}),u[f]=_(u[f],c)}s.entities[i.entityId]={...o,...i,models:u}}})},updateEntity:n=>{t(s=>{if(n.entityId&&n.models){let i=s.entities[n.entityId];if(!i){s.entities[n.entityId]=n;return}let o=Object.assign({},i.models);for(let[u,l]of Object.entries(n.models)){let c=u;c in o||(o[c]={}),o[c]=_(o[c],l)}s.entities[n.entityId]={...i,...n,models:o}}})},setHistoricalEntities:n=>{t(s=>{for(let i of n){let o=s.historical_entities[i.entityId];if(!o||o.length===0){s.historical_entities[i.entityId]=[i];continue}let u=o[o.length-1];O(i,u)||o.push(i)}})},mergeHistoricalEntities:n=>{t(s=>{for(let i of n)if(i.entityId&&i.models){let o=s.historical_entities[i.entityId];if(!o||o.length===0){s.historical_entities[i.entityId]=[i];continue}let u=o[o.length-1];O(i,u)||o.push(i)}})},updateHistoricalEntity:n=>{t(s=>{if(n.entityId){let i=s.historical_entities[n.entityId];if(!i||i.length===0)s.historical_entities[n.entityId]=[n];else{let o=i[i.length-1];O(n,o)||i.push(n)}}})},applyOptimisticUpdate:(n,s)=>{let i=a(),[o,u,l]=K(i,c=>{s(c)});t(()=>o),t(c=>{c.pendingTransactions[n]={transactionId:n,patches:u,inversePatches:l}})},revertOptimisticUpdate:n=>{let s=a().pendingTransactions[n];s&&(t(i=>$(i,s.inversePatches)),t(i=>{delete i.pendingTransactions[n]}))},confirmTransaction:n=>{t(s=>{delete s.pendingTransactions[n]})},subscribeToEntity:(n,s)=>e.subscribe(i=>{let o=i.entities[n];s(o)}),waitForEntityChange:(n,s,i=6e3)=>new Promise((o,u)=>{let l=a().entities[n];if(s(l)){o(l);return}let c=e.subscribe(b=>{let d=b.entities[n];s(d)&&(clearTimeout(f),c(),o(d))}),f=setTimeout(()=>{c(),u(new Error(`waitForEntityChange: Timeout of ${i}ms exceeded`))},i)}),getEntity:n=>a().entities[n],getEntities:n=>{let s=Object.values(a().entities);return n?s.filter(n):s},getEntitiesByModel:(n,s)=>a().getEntities(i=>!!i.models[n]?.[s]),getHistoricalEntities:n=>a().historical_entities[n]||[],getEntityAtIndex:(n,s)=>{let i=a().historical_entities[n];if(!(!i||s<0||s>=i.length))return i[s]},clearHistoricalEntities:n=>{t(s=>{n?delete s.historical_entities[n]:s.historical_entities={}})},resetStore:()=>{t(n=>{n.entities={},n.historical_entities={},n.pendingTransactions={}})}}))));return e}function Se(){return M(X)}export{M as a,Se as b};
//# sourceMappingURL=chunk-4BGAYNIW.js.map